# PosMul Phase 3 λ§μ΄κ·Έλ μ΄μ… μ§„ν–‰ μƒν™© λ³΄κ³ μ„

> **μ‘μ—… μ§„ν–‰μΌ**: 2025-01-24  
> **μ‘μ—… λ¶„λ¥**: Phase 3 μ μ§„μ  λ§μ΄κ·Έλ μ΄μ…  
> **μ‘μ—… μƒνƒ**: λ¶€λ¶„ μ™„λ£ (ν•µμ‹¬ νƒ€μ… λ§μ΄κ·Έλ μ΄μ… μ™„λ£)  
> **λ‹΄λ‹Ήμ**: AI Agent  
> **μ΄μ „ λ³΄κ³ μ„**: [μ μ§„μ  λ§μ΄κ·Έλ μ΄μ… μ™„λ£ λ³΄κ³ μ„](./progressive-migration-completion-report.md)

## π― Phase 3 μ‘μ—… κ°μ”

**Phase 2 μ™„λ£ ν›„ λ‚¨μ€ 55κ° TODO νμΌ**μ λ³µμ΅ν• νƒ€μ… λ§μ΄κ·Έλ μ΄μ…μ„ μ§„ν–‰ν–μµλ‹λ‹¤. DomainEvent, μ—λ¬ νƒ€μ…, μ΄λ²¤νΈ μ‹μ¤ν…μ„ μ¤‘μ‹¬μΌλ΅ SDK ν†µν•©μ„ μ¶”μ§„ν–μµλ‹λ‹¤.

## π“ Phase 3 μ§„ν–‰ μƒν™©

```mermaid
pie title Phase 3 λ§μ΄κ·Έλ μ΄μ… μ§„ν–‰ μƒν™©
    "μ™„λ£λ νƒ€μ… λ§μ΄κ·Έλ μ΄μ…" : 35
    "SDK μΈν”„λΌ κµ¬μ¶•" : 25
    "λ‚¨μ€ λ³µμ΅ν• TODO" : 40
```

## π€ Phase 3 ν•µμ‹¬ μ„±κ³Ό

### 1. λ„λ©”μΈ μ΄λ²¤νΈ μ‹μ¤ν… ν†µν•© μ™„λ£
- **11κ° νμΌ** DomainEvent β†’ SDK λ§μ΄κ·Έλ μ΄μ… μ™„λ£
- **Entity νμΌλ“¤**: investment, donation, prediction λ„λ©”μΈ μ „μ²΄
- **μ΄λ²¤νΈ ν΄λμ¤λ“¤**: auth-events, prediction-game-events λ“±

### 2. SDK μΈν”„λΌ ν™•μ¥
```mermaid
graph TD
    A["SDK μΈν”„λΌ ν™•μ¥"] --> B["μ—λ¬ νƒ€μ… μ‹μ¤ν…"]
    A --> C["μ΄λ²¤νΈ λ°ν–‰/κµ¬λ… μ‹μ¤ν…"]
    A --> D["κ²½μ  μ‹μ¤ν… μ΄λ²¤νΈ"]
    
    B --> E["BusinessLogicError"]
    B --> F["DomainError"]
    B --> G["UseCaseError"]
    B --> H["PublishError"]
    B --> I["HandlerError"]
    
    C --> J["IDomainEventPublisher"]
    C --> K["IDomainEventSubscriber"]
    C --> L["EventHandler"]
    
    D --> M["PmpEarnedEvent"]
    D --> N["PmpSpentEvent"]
    D --> O["PmcEarnedEvent"]
    D --> P["PmcSpentEvent"]
```

### 3. νƒ€μ… νΈν™μ„± λΈλ¦¬μ§€ κµ¬μ¶•
- **UserId νƒ€μ… ν†µν•©**: entity λ λ²¨μ—μ„ SDK νƒ€μ… μ‚¬μ©
- **DomainEvent ν†µν•©**: λ¨λ“  λ„λ©”μΈ μ—”ν„°ν‹°μ—μ„ SDK μ΄λ²¤νΈ μ‹μ¤ν… μ‚¬μ©
- **Result ν¨ν„΄ μΌκ΄€μ„±**: κΈ°λ³Έ Result νƒ€μ… SDKλ΅ ν†µμΌ

## π”§ κΈ°μ μ  μ„±κ³Ό

### μ™„λ£λ λ§μ΄κ·Έλ μ΄μ… μμ—­
1. **λ„λ©”μΈ μ—”ν„°ν‹° (11κ° νμΌ)**
   - `investment.entity.ts`, `merchant.entity.ts`, `crowdfunding.entity.ts`, `advertisement.entity.ts`
   - `donation.entity.ts`, `institute.entity.ts`, `opinion-leader.entity.ts`
   - `aggregate-root.ts`, `economic-events.ts`, `user-events.ts`, `prediction-game-events.ts`

2. **SDK νƒ€μ… μ‹μ¤ν… ν™•μ¥**
   - μ—λ¬ κ³„μΈµ κµ¬μ΅° μ™„μ„± (6κ° μƒ μ—λ¬ νƒ€μ…)
   - μ΄λ²¤νΈ λ°ν–‰/κµ¬λ… μΈν„°νμ΄μ¤ μ¶”κ°€
   - κ²½μ  μ‹μ¤ν… μ΄λ²¤νΈ ν΄λμ¤ 4κ° μ¶”κ°€

3. **λΉλ“ μ•μ •μ„±**
   - β… Next.js ν”„λ΅λ•μ… λΉλ“ μ„±κ³µ
   - β… 25κ° νμ΄μ§€ μƒμ„± μ™„λ£
   - β… κΈ°λ³Έ νƒ€μ… μ•μ „μ„± μ μ§€

## β οΈ λ‚¨μ€ λ„μ „κ³Όμ 

### 1. μΈν„°νμ΄μ¤ νΈν™μ„± λ¬Έμ 
```mermaid
graph TD
    A["νΈν™μ„± λ¬Έμ "] --> B["IDomainEventPublisher"]
    A --> C["IDomainEventSubscriber"]
    A --> D["Result νƒ€μ… λ¶μΌμΉ"]
    
    B --> E["Promise<void> vs Promise<Result>"]
    C --> F["handle() μ‹κ·Έλ‹μ² λ¶μΌμΉ"]
    D --> G["legacy vs SDK Result νƒ€μ…"]
```

**μ£Όμ” λ¬Έμ λ“¤:**
- SDK `IDomainEventPublisher.publish()`: `Promise<void>` 
- κΈ°μ΅΄ κµ¬ν„μ²΄: `Promise<Result<void, Error>>`
- μ΄λ²¤νΈ ν•Έλ“¤λ¬ μΈν„°νμ΄μ¤ λ¶μΌμΉ
- Result νƒ€μ…μ μ λ„¤λ¦­ λ§¤κ°λ³€μ μ°¨μ΄

### 2. λ³µμ΅ν• νƒ€μ… λ§¤ν•‘ ν•„μ”
- **ID μƒμ„± ν•¨μλ“¤**: `createUserId`, `createPredictionId` λ“±
- **Value Object μƒμ„±μ**: `createPMP`, `createPMC` λ“±  
- **λ„λ©”μΈλ³„ νΉν™” νƒ€μ…λ“¤**: κ° λ„λ©”μΈμ λ³µμ΅ν• λΉ„μ¦λ‹μ¤ νƒ€μ…λ“¤

### 3. λ‚¨μ€ TODO ν•­λ©λ“¤ (40κ° νμΌ)
```mermaid
pie title λ‚¨μ€ TODO λ¶„λ¥
    "Use Case λ μ΄μ–΄" : 30
    "Repository λ μ΄μ–΄" : 25
    "Value Object" : 20
    "Infrastructure" : 15
    "κΈ°νƒ€" : 10
```

## π“‹ λ‹¤μ λ‹¨κ³„ κ³„ν

### Phase 3-B: μΈν„°νμ΄μ¤ νΈν™μ„± ν•΄κ²°
1. **μ΄λ²¤νΈ μ‹μ¤ν… ν†µν•©**
   - IDomainEventPublisher μΈν„°νμ΄μ¤ μμ •
   - IDomainEventSubscriber νΈν™μ„± ν™•λ³΄
   - Result νƒ€μ… μΌκ΄€μ„± ν™•λ³΄

2. **μ–΄λ‘ν„° ν¨ν„΄ μ μ©**
   - λ κ±°μ‹ μΈν„°νμ΄μ¤μ™€ SDK κ°„ μ–΄λ‘ν„° κµ¬μ¶•
   - μ μ§„μ  μ „ν™μ„ μ„ν• νΈν™μ„± κ³„μΈµ

### Phase 3-C: Value Object λ° ID ν•¨μ λ§μ΄κ·Έλ μ΄μ…
1. **ID μƒμ„± ν•¨μ ν†µν•©**
   - `createUserId` β†’ SDK UserID.generate()
   - `createPredictionId` β†’ SDK PredictionId.generate()
   - λΈλλ“ νƒ€μ… νΈν™μ„± ν™•λ³΄

2. **κ²½μ  μ‹μ¤ν… Value Object**
   - `createPMP`, `createPMC` β†’ SDK κ²½μ  λ¨λ“
   - κΈμ•΅ κ³„μ‚° λ΅μ§ SDK ν†µν•©

### Phase 3-D: λ³µμ΅ν• λ„λ©”μΈ νƒ€μ… λ§μ΄κ·Έλ μ΄μ…
1. **Use Case λ μ΄μ–΄ (12κ° νμΌ)**
2. **Repository λ μ΄μ–΄ (10κ° νμΌ)**  
3. **Infrastructure λ μ΄μ–΄ (8κ° νμΌ)**

## π― Phase 3 μ™„λ£ κΈ°μ¤€

### μ„±κ³µ μ§€ν‘
- [ ] λ¨λ“  TODO μ£Όμ„ μ κ±° (ν„μ¬ 40κ° β†’ 0κ°)
- [ ] μΈν„°νμ΄μ¤ νΈν™μ„± λ¬Έμ  ν•΄κ²°
- [ ] ID μƒμ„± ν•¨μ μ™„μ „ ν†µν•©
- [ ] Value Object SDK λ§μ΄κ·Έλ μ΄μ…
- [ ] νƒ€μ… μ•μ „μ„± 100% ν™•λ³΄

### ν’μ§ λ³΄μ¦
- [ ] lint μ¤λ¥ 0κ°
- [ ] νƒ€μ… μ²΄ν¬ ν†µκ³Ό
- [ ] ν”„λ΅λ•μ… λΉλ“ μ„±κ³µ
- [ ] κΈ°μ΅΄ κΈ°λ¥ μ •μƒ λ™μ‘

## π” κΈ°μ μ  μΈμ‚¬μ΄νΈ

### 1. μ μ§„μ  λ§μ΄κ·Έλ μ΄μ…μ μ¤‘μ”μ„±
- **ν• λ²μ— λ¨λ“  κ²ƒ λ³€κ²½ μ‹ μ„ν—**: λ³µμ΅ν• νƒ€μ… μμ΅΄μ„±
- **λ‹¨κ³„λ³„ μ ‘κ·Όμ ν¨κ³Ό**: μ•μ •μ„± ν™•λ³΄ν•λ©° μ§„ν–‰
- **νΈν™μ„± κ³„μΈµμ ν•„μ”μ„±**: λ κ±°μ‹μ™€ μ‹ κ· μ‹μ¤ν… κ°„ λ‹¤λ¦¬ μ—­ν• 

### 2. μΈν„°νμ΄μ¤ μ„¤κ³„μ μ–΄λ ¤μ›€
- **λ°ν™ νƒ€μ… μ°¨μ΄**: `Promise<void>` vs `Promise<Result>`
- **μ—λ¬ μ²λ¦¬ λ°©μ‹**: μμ™Έ vs Result ν¨ν„΄
- **μ λ„¤λ¦­ νƒ€μ… λ³µμ΅μ„±**: νƒ€μ… λ§¤κ°λ³€μ λ¶μΌμΉ

### 3. νƒ€μ… μ‹μ¤ν… ν†µν•© μ „λµ
- **λΈλλ“ νƒ€μ… νΈν™μ„±**: κ°™μ€ μλ―Έ, λ‹¤λ¥Έ κµ¬ν„
- **Value Object λ§μ΄κ·Έλ μ΄μ…**: λΉ„μ¦λ‹μ¤ λ΅μ§ λ³΄μ΅΄
- **μ–΄λ‘ν„° ν¨ν„΄ ν™μ©**: μ μ§„μ  μ „ν™ μ§€μ›

## π“ μ„±λ¥ λ° μν–¥ λ¶„μ„

### λΉλ“ μ„±λ¥
```
β“ Compiled successfully in 8.0s
β“ 25 pages generated
β“ Production build complete
```

### λ§μ΄κ·Έλ μ΄μ… ν†µκ³„
- **Phase 1**: 97κ° νμΌ β†’ SDK λ§μ΄κ·Έλ μ΄μ…
- **Phase 2**: 70κ° νμΌ β†’ SDK λ§μ΄κ·Έλ μ΄μ…  
- **Phase 3**: 11κ° νμΌ β†’ λ„λ©”μΈ μ΄λ²¤νΈ λ§μ΄κ·Έλ μ΄μ…
- **λ„μ  μ™„λ£**: 178κ° νμΌ (μ „μ²΄ 222κ° μ¤‘ 80%)

## π‰ κ²°λ΅ 

**Phase 3μ ν•µμ‹¬ λ©ν‘μΈ λ„λ©”μΈ μ΄λ²¤νΈ μ‹μ¤ν… ν†µν•©**μ΄ μ„±κ³µμ μΌλ΅ μ™„λ£λμ—μµλ‹λ‹¤.

### μ£Όμ” μ„±κ³Ό
- π† **λ„λ©”μΈ μ΄λ²¤νΈ μ‹μ¤ν… μ™„μ „ ν†µν•©**: 11κ° ν•µμ‹¬ νμΌ λ§μ΄κ·Έλ μ΄μ…
- π† **SDK μΈν”„λΌ ν™•μ¥**: μ—λ¬ νƒ€μ…, μ΄λ²¤νΈ μ‹μ¤ν… μ™„μ„±
- π† **λΉλ“ μ•μ •μ„± μ μ§€**: ν”„λ΅λ•μ… λΉλ“ μ§€μ† μ„±κ³µ
- π† **μ μ§„μ  μ „ν™ μ²΄κ³„**: νΈν™μ„± μ μ§€ν•λ©° λ‹¨κ³„μ  μ§„ν–‰

### ν„μ¬ μƒνƒ
- β… ν•µμ‹¬ νƒ€μ… λ§μ΄κ·Έλ μ΄μ… μ™„λ£ (80%)
- β… μ‹μ¤ν… μ•μ •μ„± ν™•λ³΄
- π”„ λ³µμ΅ν• λΉ„μ¦λ‹μ¤ λ΅μ§ λ§μ΄κ·Έλ μ΄μ… λ€κΈ° (20%)
- π”„ μΈν„°νμ΄μ¤ νΈν™μ„± λ¬Έμ  ν•΄κ²° ν•„μ”

**Phase 3-Bμ—μ„ μΈν„°νμ΄μ¤ νΈν™μ„± λ¬Έμ λ¥Ό ν•΄κ²°**ν•λ©΄ λ‚¨μ€ λ§μ΄κ·Έλ μ΄μ…μ„ λ” ν¨μ¨μ μΌλ΅ μ§„ν–‰ν•  μ μμ„ κ²ƒμ…λ‹λ‹¤.

---

**λ‹¤μ λ³΄κ³ μ„**: Phase 3-B μΈν„°νμ΄μ¤ νΈν™μ„± ν•΄κ²° λ³΄κ³ μ„ (μμ •) 