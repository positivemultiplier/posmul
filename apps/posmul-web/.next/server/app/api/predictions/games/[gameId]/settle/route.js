(()=>{var e={};e.id=38,e.ids=[38],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10038:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>f,routeModule:()=>p,serverHooks:()=>O,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>l});var s={};t.r(s),t.d(s,{GET:()=>u,POST:()=>d});var o=t(59866),n=t(53027),i=t(84514),a=t(39259);!function(){var e=Error("Cannot find module '@/bounded-contexts/prediction/application/use-cases/settle-prediction-game.use-case'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/bounded-contexts/prediction/domain/services/prediction-economic.service'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/bounded-contexts/prediction/infrastructure/repositories/supabase-prediction-game.repository'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/bounded-contexts/prediction/infrastructure/repositories/supabase-prediction.repository'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/shared/economy-kernel/services/money-wave-calculator.service'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/shared/events/event-publisher'");throw e.code="MODULE_NOT_FOUND",e}();class c{constructor(e){this.publisher=e}async publish(e){let r=await this.publisher.publish(e);if(!r.success)throw Error(`Event publishing failed: ${r.error.message}`)}async publishBatch(e){let r=await this.publisher.publishBatch(e);if(!r.success)throw Error(`Batch event publishing failed: ${r.error.message}`)}}async function d(e,{params:r}){try{let{gameId:t}=await r,s=await e.json();if(!t)return a.NextResponse.json({success:!1,error:{code:"INVALID_GAME_ID",message:"Game ID is required"}},{status:400});if(!s.correctOptionId||!s.adminUserId)return a.NextResponse.json({success:!1,error:{code:"MISSING_REQUIRED_FIELDS",message:"correctOptionId and adminUserId are required"}},{status:400});let o=Object(function(){var e=Error("Cannot find module '@/bounded-contexts/prediction/infrastructure/repositories/supabase-prediction-game.repository'");throw e.code="MODULE_NOT_FOUND",e}())();Object(function(){var e=Error("Cannot find module '@/bounded-contexts/prediction/infrastructure/repositories/supabase-prediction.repository'");throw e.code="MODULE_NOT_FOUND",e}())();let n=Object(function(){var e=Error("Cannot find module '@/shared/events/event-publisher'");throw e.code="MODULE_NOT_FOUND",e}())(),i=new c(n),d=Object(function(){var e=Error("Cannot find module '@/bounded-contexts/prediction/domain/services/prediction-economic.service'");throw e.code="MODULE_NOT_FOUND",e}())(i),u=Object(function(){var e=Error("Cannot find module '@/shared/economy-kernel/services/money-wave-calculator.service'");throw e.code="MODULE_NOT_FOUND",e}())(),p=Object(function(){var e=Error("Cannot find module '@/bounded-contexts/prediction/application/use-cases/settle-prediction-game.use-case'");throw e.code="MODULE_NOT_FOUND",e}())(o,d,u),m={gameId:t,correctOptionId:s.correctOptionId,adminUserId:s.adminUserId,finalResults:s.finalResults},l=await p.execute(m);if(!l.success){if(l.error.message.includes("not found"))return a.NextResponse.json({success:!1,error:{code:"GAME_NOT_FOUND",message:"Prediction game not found"}},{status:404});if(l.error.message.includes("already settled"))return a.NextResponse.json({success:!1,error:{code:"ALREADY_SETTLED",message:"Game has already been settled"}},{status:409});if(l.error.message.includes("not ended"))return a.NextResponse.json({success:!1,error:{code:"GAME_NOT_ENDED",message:"Game has not ended yet"}},{status:409});if(l.error.message.includes("unauthorized"))return a.NextResponse.json({success:!1,error:{code:"UNAUTHORIZED",message:"Only authorized admins can settle games"}},{status:403});return a.NextResponse.json({success:!1,error:{code:"SETTLEMENT_FAILED",message:l.error.message}},{status:500})}return a.NextResponse.json({success:!0,data:l.data,metadata:{timestamp:new Date,version:"1.0.0"}},{status:200})}catch(e){return console.error("POST /api/predictions/games/[gameId]/settle error:",e),a.NextResponse.json({success:!1,error:{code:"INTERNAL_SERVER_ERROR",message:"An unexpected error occurred"}},{status:500})}}async function u(e,{params:r}){try{let{gameId:e}=await r;if(!e)return a.NextResponse.json({success:!1,error:{code:"INVALID_GAME_ID",message:"Game ID is required"}},{status:400});let t=Object(function(){var e=Error("Cannot find module '@/bounded-contexts/prediction/infrastructure/repositories/supabase-prediction-game.repository'");throw e.code="MODULE_NOT_FOUND",e}())(),s=Object(function(){var e=Error("Cannot find module '@/bounded-contexts/prediction/infrastructure/repositories/supabase-prediction.repository'");throw e.code="MODULE_NOT_FOUND",e}())(),o=await t.findById(e);if(!o.success||!o.data)return a.NextResponse.json({success:!1,error:{code:"GAME_NOT_FOUND",message:"Prediction game not found"}},{status:404});let n=o.data,i=await s.findByGame(e),c=i.success&&i.data.items||[],d=n.status.isEnded()&&new Date>=n.configuration.settlementTime&&c.length>0;return a.NextResponse.json({success:!0,data:{gameId:e,gameStatus:n.status,canSettle:d,settlementInfo:{endTime:n.configuration.endTime,settlementTime:n.configuration.settlementTime,totalParticipants:c.length,options:n.configuration.options,currentTime:new Date},participationSummary:c.map(e=>({userId:e.userId,selectedOptionId:e.selectedOptionId,stakeAmount:e.stakeAmount,confidence:e.confidence}))},metadata:{timestamp:new Date,version:"1.0.0"}})}catch(e){return console.error("GET /api/predictions/games/[gameId]/settle error:",e),a.NextResponse.json({success:!1,error:{code:"INTERNAL_SERVER_ERROR",message:"An unexpected error occurred"}},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/predictions/games/[gameId]/settle/route",pathname:"/api/predictions/games/[gameId]/settle",filename:"route",bundlePath:"app/api/predictions/games/[gameId]/settle/route"},resolvedPagePath:"C:\\G\\posmul\\apps\\posmul-web\\src\\app\\api\\predictions\\games\\[gameId]\\settle\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:l,serverHooks:O}=p;function f(){return(0,i.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:l})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},36232:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},72680:()=>{}};var r=require("../../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[351,796],()=>t(10038));module.exports=s})();