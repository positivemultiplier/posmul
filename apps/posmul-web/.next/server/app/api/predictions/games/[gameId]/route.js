(()=>{var e={};e.id=696,e.ids=[696],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19756:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>E,routeModule:()=>m,serverHooks:()=>g,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>l});var r={};s.r(r),s.d(r,{DELETE:()=>d,GET:()=>c,PUT:()=>u});var n=s(59866),o=s(53027),a=s(84514),i=s(39259);async function c(e,{params:t}){try{let{gameId:e}=await t;if(!e)return i.NextResponse.json({success:!1,error:{code:"INVALID_GAME_ID",message:"Game ID is required"}},{status:400});let s=Object(function(){var e=Error("Cannot find module '@/bounded-contexts/prediction/infrastructure/repositories/supabase-prediction-game.repository'");throw e.code="MODULE_NOT_FOUND",e}())(),r=Object(function(){var e=Error("Cannot find module '@/bounded-contexts/prediction/application/use-cases/get-prediction-game-by-id.use-case'");throw e.code="MODULE_NOT_FOUND",e}())(s),n=await r.execute({gameId:e,includeParticipations:!0,includeStatistics:!0});if(!n.success){if(n.error.message.includes("not found"))return i.NextResponse.json({success:!1,error:{code:"GAME_NOT_FOUND",message:"Prediction game not found"}},{status:404});return i.NextResponse.json({success:!1,error:{code:"FETCH_GAME_FAILED",message:n.error.message}},{status:500})}return i.NextResponse.json({success:!0,data:n.data,metadata:{timestamp:new Date,version:"1.0.0"}})}catch(e){return console.error("GET /api/predictions/games/[gameId] error:",e),i.NextResponse.json({success:!1,error:{code:"INTERNAL_SERVER_ERROR",message:"An unexpected error occurred"}},{status:500})}}async function u(e,{params:t}){try{let{gameId:s}=await t,r=await e.json();if(!s)return i.NextResponse.json({success:!1,error:{code:"INVALID_GAME_ID",message:"Game ID is required"}},{status:400});let n=function(e){let t=[];return e.updatedBy||t.push("Updated by user ID is required"),e.title&&("string"!=typeof e.title||e.title.length<5)&&t.push("Title must be at least 5 characters long"),e.description&&("string"!=typeof e.description||e.description.length<20)&&t.push("Description must be at least 20 characters long"),e.endTime&&e.settlementTime&&new Date(e.endTime)>=new Date(e.settlementTime)&&t.push("Settlement time must be after end time"),e.minimumStake&&("number"!=typeof e.minimumStake||e.minimumStake<1)&&t.push("Minimum stake must be at least 1"),e.maximumStake&&e.minimumStake&&e.maximumStake<=e.minimumStake&&t.push("Maximum stake must be greater than minimum stake"),e.maxParticipants&&("number"!=typeof e.maxParticipants||e.maxParticipants<1)&&t.push("Maximum participants must be at least 1"),{valid:0===t.length,errors:t.length>0?t:void 0}}(r);if(!n.valid)return i.NextResponse.json({success:!1,error:{code:"VALIDATION_ERROR",message:"Invalid request data",details:n.errors}},{status:400});let o=Object(function(){var e=Error("Cannot find module '@/bounded-contexts/prediction/infrastructure/repositories/supabase-prediction-game.repository'");throw e.code="MODULE_NOT_FOUND",e}())(),a=Object(function(){var e=Error("Cannot find module '@/bounded-contexts/prediction/application/use-cases/update-prediction-game.use-case'");throw e.code="MODULE_NOT_FOUND",e}())(o),c=await a.execute({gameId:s,updatedBy:r.updatedBy,updates:{title:r.title,description:r.description,endTime:r.endTime?new Date(r.endTime):void 0,settlementTime:r.settlementTime?new Date(r.settlementTime):void 0,minimumStake:r.minimumStake,maximumStake:r.maximumStake,maxParticipants:r.maxParticipants}});if(!c.success){if(c.error.message.includes("not found"))return i.NextResponse.json({success:!1,error:{code:"GAME_NOT_FOUND",message:"Prediction game not found"}},{status:404});if(c.error.message.includes("unauthorized"))return i.NextResponse.json({success:!1,error:{code:"UNAUTHORIZED",message:"Only the game creator can update this game"}},{status:403});return i.NextResponse.json({success:!1,error:{code:"UPDATE_GAME_FAILED",message:c.error.message}},{status:500})}return i.NextResponse.json({success:!0,data:c.data,metadata:{timestamp:new Date,version:"1.0.0"}})}catch(e){return console.error("PUT /api/predictions/games/[gameId] error:",e),i.NextResponse.json({success:!1,error:{code:"INTERNAL_SERVER_ERROR",message:"An unexpected error occurred"}},{status:500})}}async function d(e,{params:t}){try{let{gameId:s}=await t,{searchParams:r}=new URL(e.url),n=r.get("deletedBy"),o=r.get("reason")||"User requested deletion";if(!s)return i.NextResponse.json({success:!1,error:{code:"INVALID_GAME_ID",message:"Game ID is required"}},{status:400});if(!n)return i.NextResponse.json({success:!1,error:{code:"MISSING_USER_ID",message:"User ID is required for deletion"}},{status:400});let a=Object(function(){var e=Error("Cannot find module '@/bounded-contexts/prediction/infrastructure/repositories/supabase-prediction-game.repository'");throw e.code="MODULE_NOT_FOUND",e}())(),c=Object(function(){var e=Error("Cannot find module '@/bounded-contexts/prediction/application/use-cases/delete-prediction-game.use-case'");throw e.code="MODULE_NOT_FOUND",e}())(a),u=await c.execute({gameId:s,deletedBy:n,reason:o});if(!u.success){if(u.error.message.includes("not found"))return i.NextResponse.json({success:!1,error:{code:"GAME_NOT_FOUND",message:"Prediction game not found"}},{status:404});if(u.error.message.includes("unauthorized"))return i.NextResponse.json({success:!1,error:{code:"UNAUTHORIZED",message:"Only the game creator or admin can delete this game"}},{status:403});if(u.error.message.includes("cannot delete active"))return i.NextResponse.json({success:!1,error:{code:"CANNOT_DELETE_ACTIVE_GAME",message:"Cannot delete an active game with participants"}},{status:409});return i.NextResponse.json({success:!1,error:{code:"DELETE_GAME_FAILED",message:u.error.message}},{status:500})}return i.NextResponse.json({success:!0,data:{gameId:s,deletedAt:new Date,reason:o},metadata:{timestamp:new Date,version:"1.0.0"}})}catch(e){return console.error("DELETE /api/predictions/games/[gameId] error:",e),i.NextResponse.json({success:!1,error:{code:"INTERNAL_SERVER_ERROR",message:"An unexpected error occurred"}},{status:500})}}!function(){var e=Error("Cannot find module '@/bounded-contexts/prediction/application/use-cases/delete-prediction-game.use-case'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/bounded-contexts/prediction/application/use-cases/get-prediction-game-by-id.use-case'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/bounded-contexts/prediction/application/use-cases/update-prediction-game.use-case'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/bounded-contexts/prediction/infrastructure/repositories/supabase-prediction-game.repository'");throw e.code="MODULE_NOT_FOUND",e}();let m=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/predictions/games/[gameId]/route",pathname:"/api/predictions/games/[gameId]",filename:"route",bundlePath:"app/api/predictions/games/[gameId]/route"},resolvedPagePath:"C:\\G\\posmul\\apps\\posmul-web\\src\\app\\api\\predictions\\games\\[gameId]\\route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:p,workUnitAsyncStorage:l,serverHooks:g}=m;function E(){return(0,a.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:l})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},36232:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},72680:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[351,796],()=>s(19756));module.exports=r})();