---
description: supabase,ë°ì´í„°ë² ì´ìŠ¤, ìŠ¤í‚¤ë§ˆ, ë§ˆì´ê·¸ë ˆì´ì…˜,mcp_supabase, SQL, í…Œì´ë¸”, db
globs: 
alwaysApply: false
---


# PosMul - Supabase MCP Integration Rules

## ğŸ”¥ CRITICAL: MCP-First Development

**ì´ í”„ë¡œì íŠ¸ëŠ” Supabase MCP (Model Context Protocol)ë¥¼ í†µí•´ ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.**

### MCP ë„êµ¬ ìš°ì„ ìˆœìœ„

1. **`mcp_supabase_list_projects`** - í”„ë¡œì íŠ¸ ì •ë³´ ì¡°íšŒ
2. **`mcp_supabase_list_tables`** - ìŠ¤í‚¤ë§ˆ ê²€ì‚¬
3. **`mcp_supabase_apply_migration`** - DDL ì‘ì—… (ìŠ¤í‚¤ë§ˆ ë³€ê²½)
4. **`mcp_supabase_execute_sql`** - DML ì‘ì—… (ë°ì´í„° ì¿¼ë¦¬)
5. **`mcp_supabase_get_advisors`** - ë³´ì•ˆ/ì„±ëŠ¥ ê²€ì‚¬
6. **`mcp_supabase_generate_typescript_types`** - íƒ€ì… ìƒì„±
7. **`mcp_supabase_search_docs`** - Supabase ë¬¸ì„œ ê²€ìƒ‰
8. **`mcp_supabase_list_edge_functions`** - Edge Function ê´€ë¦¬
9. **`mcp_supabase_deploy_edge_function`** - Edge Function ë°°í¬

### âŒ ì‚¬ìš© ê¸ˆì§€

- Supabase CLI ëª…ë ¹ì–´ (`supabase db push`, `supabase migration new` ë“±)
- ì§ì ‘ SQL íŒŒì¼ ì‹¤í–‰
- ìˆ˜ë™ ìŠ¤í‚¤ë§ˆ ê´€ë¦¬

## MCP ê¸°ë°˜ ê°œë°œ íŒ¨í„´

### 1. ìŠ¤í‚¤ë§ˆ ìƒì„±/ìˆ˜ì •

```typescript
// âœ… ì˜¬ë°”ë¥¸ ë°©ë²•: MCP ì‚¬ìš©
await mcp_supabase_apply_migration({
  project_id: "your-project-id",
  name: "create_prediction_tables",
  query: `
    CREATE TABLE prediction_games (
      id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
      title TEXT NOT NULL,
      created_at TIMESTAMPTZ DEFAULT NOW()
    );
  `,
});

// âŒ ì˜ëª»ëœ ë°©ë²•: CLI ì‚¬ìš© ê¸ˆì§€
// supabase migration new create_prediction_tables
```

### 2. ë°ì´í„° ì¿¼ë¦¬

```typescript
// âœ… ì˜¬ë°”ë¥¸ ë°©ë²•: MCP ì‚¬ìš©
await mcp_supabase_execute_sql({
  project_id: "your-project-id",
  query: "SELECT * FROM prediction_games WHERE status = 'active'",
});

// âŒ ì˜ëª»ëœ ë°©ë²•: ì§ì ‘ SQL íŒŒì¼ ì‹¤í–‰ ê¸ˆì§€
// psql -f query.sql
```

### 3. Edge Functions ê´€ë¦¬

```typescript
// âœ… ì˜¬ë°”ë¥¸ ë°©ë²•: MCP ì‚¬ìš©
await mcp_supabase_deploy_edge_function({
  project_id: "your-project-id",
  name: "prediction-scorer",
  files: [
    {
      name: "index.ts",
      content: `
        import { serve } from "https://deno.land/std@0.168.0/http/server.ts"
        
        serve(async (req: Request) => {
          return new Response("Hello from Edge Function!")
        })
      `,
    },
  ],
});

// âŒ ì˜ëª»ëœ ë°©ë²•: CLI ì‚¬ìš© ê¸ˆì§€
// supabase functions deploy prediction-scorer
```

### 4. ë³´ì•ˆ ë° ì„±ëŠ¥ ê²€ì‚¬

```typescript
// âœ… ì •ê¸°ì  ë³´ì•ˆ ê²€ì‚¬
await mcp_supabase_get_advisors({
  project_id: "your-project-id",
  type: "security",
});

await mcp_supabase_get_advisors({
  project_id: "your-project-id",
  type: "performance",
});
```

### 5. TypeScript íƒ€ì… ìƒì„±

```typescript
// âœ… ìŠ¤í‚¤ë§ˆ ë³€ê²½ í›„ íƒ€ì… ìë™ ìƒì„±
await mcp_supabase_generate_typescript_types({
  project_id: "your-project-id",
});
```

## ì•ˆì „ ëª¨ë“œ ì„¤ì •

### ê¶Œì¥ MCP ì„œë²„ ì„¤ì •

```json
{
  "mcpServers": {
    "supabase": {
      "command": "npx",
      "args": [
        "-y",
        "@supabase/mcp-server-supabase@latest",
        "--read-only", // ğŸ”’ ì½ê¸° ì „ìš© ëª¨ë“œ (ê¸°ë³¸ ê¶Œì¥)
        "--project-ref=your-project-ref", // ğŸ¯ í”„ë¡œì íŠ¸ ë²”ìœ„ ì§€ì • (ê¸°ë³¸ ê¶Œì¥)
        "--features=database,docs,development,functions"
      ],
      "env": {
        "SUPABASE_ACCESS_TOKEN": "your-token"
      }
    }
  }
}
```

### ê¸°ëŠ¥ ê·¸ë£¹ ì„ íƒ

- `account`: ê³„ì • ê´€ë¦¬ (list_projects, create_project ë“±)
- `database`: ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—… (í•„ìˆ˜)
- `docs`: ë¬¸ì„œ ê²€ìƒ‰ (ê¶Œì¥)
- `development`: ê°œë°œ ë„êµ¬ (get_project_url, get_anon_key ë“±)
- `functions`: Edge Functions ê´€ë¦¬
- `debug`: ë¡œê·¸ ë° ì–´ë“œë°”ì´ì €
- `branching`: ë¸Œëœì¹˜ ê´€ë¦¬ (ì‹¤í—˜ì , ìœ ë£Œ í”Œëœ í•„ìš”)
- `storage`: ìŠ¤í† ë¦¬ì§€ ê´€ë¦¬ (ì„ íƒì )

## Repository êµ¬í˜„ íŒ¨í„´

### MCP ê¸°ë°˜ Repository

```typescript
export class McpSupabasePredictionGameRepository
  implements IPredictionGameRepository
{
  constructor(
    private readonly projectId: string,
    private readonly mcpClient: SupabaseMcpClient
  ) {}

  async save(game: PredictionGame): Promise<Result<void, RepositoryError>> {
    try {
      // MCPë¥¼ í†µí•œ ë°ì´í„° ì €ì¥
      await this.mcpClient.execute_sql({
        project_id: this.projectId,
        query: `
          INSERT INTO prediction_games (id, title, status, created_at)
          VALUES ($1, $2, $3, $4)
          ON CONFLICT (id) DO UPDATE SET
            title = EXCLUDED.title,
            status = EXCLUDED.status,
            updated_at = NOW()
        `,
        params: [game.id, game.title, game.status, game.createdAt],
      });

      return { success: true, data: undefined };
    } catch (error) {
      return {
        success: false,
        error: new RepositoryError("Save failed", error),
      };
    }
  }

  async findById(
    id: PredictionGameId
  ): Promise<Result<PredictionGame | null, RepositoryError>> {
    try {
      const result = await this.mcpClient.execute_sql({
        project_id: this.projectId,
        query: "SELECT * FROM prediction_games WHERE id = $1",
        params: [id],
      });

      if (result.rows.length === 0) {
        return { success: true, data: null };
      }

      const game = this.mapRowToDomain(result.rows[0]);
      return { success: true, data: game };
    } catch (error) {
      return {
        success: false,
        error: new RepositoryError("Find failed", error),
      };
    }
  }
}
```

## ê²½ì œ ì‹œìŠ¤í…œ í†µí•©

### MCPë¥¼ í†µí•œ ê²½ì œ í…Œì´ë¸” ë§ˆì´ê·¸ë ˆì´ì…˜

```typescript
// PMP/PMC ê³„ì • í…Œì´ë¸” ìƒì„±
await mcp_supabase_apply_migration({
  project_id: "your-project-id",
  name: "create_economic_tables",
  query: `
    -- PMP ê³„ì • í…Œì´ë¸”
    CREATE TABLE pmp_accounts (
      user_id UUID PRIMARY KEY REFERENCES auth.users(id),
      balance DECIMAL(15,2) NOT NULL DEFAULT 0,
      created_at TIMESTAMPTZ DEFAULT NOW(),
      updated_at TIMESTAMPTZ DEFAULT NOW()
    );

    -- PMC ê³„ì • í…Œì´ë¸”  
    CREATE TABLE pmc_accounts (
      user_id UUID PRIMARY KEY REFERENCES auth.users(id),
      balance DECIMAL(15,2) NOT NULL DEFAULT 0,
      created_at TIMESTAMPTZ DEFAULT NOW(),
      updated_at TIMESTAMPTZ DEFAULT NOW()
    );

    -- ê²½ì œ íŠ¸ëœì­ì…˜ í…Œì´ë¸”
    CREATE TABLE economic_transactions (
      id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
      user_id UUID NOT NULL REFERENCES auth.users(id),
      transaction_type TEXT NOT NULL CHECK (transaction_type IN ('pmp_earned', 'pmp_spent', 'pmc_earned', 'pmc_spent')),
      amount DECIMAL(15,2) NOT NULL,
      source_domain TEXT NOT NULL,
      source_id UUID NOT NULL,
      created_at TIMESTAMPTZ DEFAULT NOW()
    );

    -- RLS ì •ì±…
    ALTER TABLE pmp_accounts ENABLE ROW LEVEL SECURITY;
    ALTER TABLE pmc_accounts ENABLE ROW LEVEL SECURITY;
    ALTER TABLE economic_transactions ENABLE ROW LEVEL SECURITY;

    -- ì‚¬ìš©ìëŠ” ìì‹ ì˜ ê³„ì •ë§Œ ì¡°íšŒ ê°€ëŠ¥
    CREATE POLICY "Users can view own PMP account" ON pmp_accounts
      FOR SELECT USING (auth.uid() = user_id);
    
    CREATE POLICY "Users can view own PMC account" ON pmc_accounts  
      FOR SELECT USING (auth.uid() = user_id);

    CREATE POLICY "Users can view own transactions" ON economic_transactions
      FOR SELECT USING (auth.uid() = user_id);
  `,
});
```

## ê°œë°œ ì›Œí¬í”Œë¡œìš°

### 1. ìŠ¤í‚¤ë§ˆ ë³€ê²½ â†’ íƒ€ì… ìƒì„± â†’ ì½”ë“œ ì—…ë°ì´íŠ¸

```typescript
// 1. ìŠ¤í‚¤ë§ˆ ë³€ê²½
await mcp_supabase_apply_migration({...});

// 2. íƒ€ì… ìë™ ìƒì„±
const types = await mcp_supabase_generate_typescript_types({
  project_id: "your-project-id"
});

// 3. íƒ€ì… íŒŒì¼ ì €ì¥
await writeFile('src/types/database.ts', types);
```

### 2. ë³´ì•ˆ ê²€ì‚¬ ìë™í™”

```typescript
// ìŠ¤í‚¤ë§ˆ ë³€ê²½ í›„ ìë™ ë³´ì•ˆ ê²€ì‚¬
const securityIssues = await mcp_supabase_get_advisors({
  project_id: "your-project-id",
  type: "security",
});

if (securityIssues.length > 0) {
  console.warn("âš ï¸ ë³´ì•ˆ ì´ìŠˆ ë°œê²¬:", securityIssues);
}
```

### 3. ë¬¸ì„œ ê²€ìƒ‰ í™œìš©

```typescript
// ê°œë°œ ì¤‘ Supabase ê¸°ëŠ¥ ê²€ìƒ‰
const docs = await mcp_supabase_search_docs({
  query: "Row Level Security policies setup",
});
```

## ğŸš¨ ì¤‘ìš” ì£¼ì˜ì‚¬í•­

1. **ì ˆëŒ€ CLI ëª…ë ¹ì–´ ì‚¬ìš© ê¸ˆì§€** - ëª¨ë“  ì‘ì—…ì€ MCPë¥¼ í†µí•´ì„œë§Œ
2. **ì½ê¸° ì „ìš© ëª¨ë“œ ê¸°ë³¸ ì„¤ì •** - ì‹¤ìˆ˜ë¡œ ì¸í•œ ë°ì´í„° ì†ì‹¤ ë°©ì§€
3. **í”„ë¡œì íŠ¸ ë²”ìœ„ ì§€ì •** - ë‹¤ë¥¸ í”„ë¡œì íŠ¸ ì ‘ê·¼ ë°©ì§€
4. **ì •ê¸°ì  ë³´ì•ˆ ê²€ì‚¬** - ìŠ¤í‚¤ë§ˆ ë³€ê²½ í›„ advisor ì‹¤í–‰
5. **íƒ€ì… ìë™ ìƒì„±** - ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹œ íƒ€ì… ë™ê¸°í™” í•„ìˆ˜

## í˜¸í™˜ì„±

- âœ… Cursor (ì™„ì „ ì§€ì›)
- âœ… Windsurf (ì™„ì „ ì§€ì›)
- âœ… Claude Desktop (ì™„ì „ ì§€ì›)
- âœ… Cline (ì™„ì „ ì§€ì›)
- âœ… VS Code with Copilot (ì™„ì „ ì§€ì›)

---

**ì´ ê·œì¹™ì„ ë”°ë¥´ë©´ Supabase ê³µì‹ MCP í‘œì¤€ì— ì™„ë²½íˆ ë¶€í•©í•˜ëŠ” ê°œë°œ í™˜ê²½ì„ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**
